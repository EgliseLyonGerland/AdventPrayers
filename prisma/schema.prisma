datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id    String @id @default(cuid())
  email String @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  password Password?
  notes    Note[]
}

model Password {
  hash String

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String @unique
}

model Note {
  id    String @id @default(cuid())
  title String
  body  String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String
}

model Person {
  id          String   @id @default(cuid())
  slug        String   @unique
  firstName   String
  lastName    String
  gender      String
  email       String?
  age         String   @default("18+")
  archived    Boolean  @default(false)
  excluding   Person[] @relation("PersonExcluded")
  excludedBy  Person[] @relation("PersonExcluded")
  players     Player[] @relation("Player")
  assignments Player[] @relation("Assigned")
}

model Draw {
  year    Int      @id
  players Player[]
}

model Player {
  draw       Draw   @relation(fields: [drawYear], references: [year])
  drawYear   Int
  person     Person @relation("Player", fields: [personId], references: [id])
  personId   String
  assigned   Person @relation("Assigned", fields: [assignedId], references: [id])
  assignedId String

  @@id([drawYear, personId])
}
